<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Predict Price - RealEstiMate</title>
    <link rel="stylesheet" href="shared.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Navigation (only visible when logged in) -->
    <nav class="navbar" style="display: none;">
        <div class="nav-container">
            <a href="/" class="logo">RealEstiMate</a>
            <ul class="nav-links">
                <li><a href="/">Home</a></li>
                <li><a href="/prediction.html" class="active">Predict</a></li>
                <li><a href="/about.html">About</a></li>
                <li><a href="/contact.html">Contact</a></li>
            </ul>
        </div>
    </nav>

    <!-- Background with same aesthetic as login page -->
    <div class="prediction-background">
        <div class="background-overlay"></div>
    </div>

    <!-- Prediction Page Container -->
    <div class="prediction-page-container">
        <!-- Page Title -->
        <div class="prediction-header">
            <h2 class="prediction-title">Predict House Price</h2>
            <p class="prediction-subtitle">Enter your property details to get an accurate price prediction</p>
        </div>

        <!-- Prediction Form Card -->
        <div class="prediction-card">
            <form id="predictionForm">
                <div class="prediction-form-grid">
                    <!-- Location Fields -->
                    <div class="prediction-form-group">
                        <label for="State" class="prediction-label">State</label>
                        <select id="State" name="State" required class="prediction-input">
                            <option value="">Select State</option>
                        </select>
                    </div>

                    <div class="prediction-form-group">
                        <label for="City" class="prediction-label">City</label>
                        <select id="City" name="City" required disabled class="prediction-input">
                            <option value="">Select City</option>
                        </select>
                    </div>

                    <div class="prediction-form-group">
                        <label for="Locality" class="prediction-label">Locality</label>
                        <select id="Locality" name="Locality" required disabled class="prediction-input">
                            <option value="">Select Locality</option>
                        </select>
                    </div>

                    <!-- Property Details -->
                    <div class="prediction-form-group">
                        <label for="Property_Type" class="prediction-label">Property Type</label>
                        <select id="Property_Type" name="Property_Type" required class="prediction-input">
                            <option value="">Select Property Type</option>
                            <option value="Apartment">Apartment</option>
                            <option value="Independent House">Independent House</option>
                            <option value="Villa">Villa</option>
                        </select>
                    </div>

                    <div class="prediction-form-group">
                        <label for="BHK" class="prediction-label">BHK</label>
                        <input type="number" id="BHK" name="BHK" min="1" max="10" required class="prediction-input" placeholder="Number of bedrooms">
                    </div>

                    <div class="prediction-form-group">
                        <label for="Size_in_SqFt" class="prediction-label">Area (SqFt)</label>
                        <input type="number" id="Size_in_SqFt" name="Size_in_SqFt" min="1" required class="prediction-input" placeholder="Size in square feet">
                    </div>

                    <div class="prediction-form-group">
                        <label for="Furnished_Status" class="prediction-label">Furnished Status</label>
                        <select id="Furnished_Status" name="Furnished_Status" required class="prediction-input">
                            <option value="">Select Status</option>
                            <option value="Furnished">Furnished</option>
                            <option value="Semi-furnished">Semi-furnished</option>
                            <option value="Unfurnished">Unfurnished</option>
                        </select>
                    </div>

                    <div class="prediction-form-group">
                        <label for="Floor_No" class="prediction-label">Floor Number</label>
                        <input type="number" id="Floor_No" name="Floor_No" min="0" required class="prediction-input" placeholder="Floor number">
                    </div>

                    <div class="prediction-form-group">
                        <label for="Total_Floors" class="prediction-label">Total Floors</label>
                        <input type="number" id="Total_Floors" name="Total_Floors" min="1" required class="prediction-input" placeholder="Total floors in building">
                    </div>

                    <div class="prediction-form-group">
                        <label for="Age_of_Property" class="prediction-label">Age of Property (Years)</label>
                        <input type="number" id="Age_of_Property" name="Age_of_Property" min="0" required class="prediction-input" placeholder="Property age in years">
                    </div>

                    <!-- Nearby Facilities -->
                    <div class="prediction-form-group">
                        <label for="Nearby_Schools" class="prediction-label">Nearby Schools</label>
                        <input type="number" id="Nearby_Schools" name="Nearby_Schools" min="0" required class="prediction-input" placeholder="Number of nearby schools">
                    </div>

                    <div class="prediction-form-group">
                        <label for="Nearby_Hospitals" class="prediction-label">Nearby Hospitals</label>
                        <input type="number" id="Nearby_Hospitals" name="Nearby_Hospitals" min="0" required class="prediction-input" placeholder="Number of nearby hospitals">
                    </div>

                    <div class="prediction-form-group">
                        <label for="Public_Transport_Accessibility" class="prediction-label">Public Transport Accessibility</label>
                        <select id="Public_Transport_Accessibility" name="Public_Transport_Accessibility" required class="prediction-input">
                            <option value="">Select Level</option>
                            <option value="High">High</option>
                            <option value="Medium">Medium</option>
                            <option value="Low">Low</option>
                        </select>
                    </div>

                    <!-- Additional Features -->
                    <div class="prediction-form-group">
                        <label for="Parking_Space" class="prediction-label">Parking Space</label>
                        <select id="Parking_Space" name="Parking_Space" required class="prediction-input">
                            <option value="">Select</option>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    </div>

                    <div class="prediction-form-group">
                        <label for="Security" class="prediction-label">Security</label>
                        <select id="Security" name="Security" required class="prediction-input">
                            <option value="">Select</option>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    </div>

                    <div class="prediction-form-group">
                        <label for="Amenities" class="prediction-label">Amenities</label>
                        <select id="Amenities" name="Amenities" required class="prediction-input">
                            <option value="">Select Amenities Count</option>
                            <option value="Club House">Club House</option>
                            <option value="Gym">Gym</option>
                            <option value="Playground">Playground</option>
                            <option value="Pool">Pool</option>
                            <option value="Garden">Garden</option>
                        </select>
                    </div>

                    <div class="prediction-form-group">
                        <label for="Facing" class="prediction-label">Facing</label>
                        <select id="Facing" name="Facing" required class="prediction-input">
                            <option value="">Select Direction</option>
                            <option value="North">North</option>
                            <option value="South">South</option>
                            <option value="East">East</option>
                            <option value="West">West</option>
                        </select>
                    </div>

                    <div class="prediction-form-group">
                        <label for="Owner_Type" class="prediction-label">Owner Type</label>
                        <select id="Owner_Type" name="Owner_Type" required class="prediction-input">
                            <option value="">Select Type</option>
                            <option value="Owner">Owner</option>
                            <option value="Builder">Builder</option>
                            <option value="Broker">Broker</option>
                        </select>
                    </div>

                    <div class="prediction-form-group">
                        <label for="Availability_Status" class="prediction-label">Availability Status</label>
                        <select id="Availability_Status" name="Availability_Status" required class="prediction-input">
                            <option value="">Select Status</option>
                            <option value="Ready_to_Move">Ready to Move</option>
                            <option value="Under_Construction">Under Construction</option>
                        </select>
                    </div>
                </div>

                <button type="submit" class="prediction-btn" id="predictBtn">
                    Predict Price
                </button>
            </form>

            <div id="result" class="prediction-result"></div>
        </div>
    </div>

    <script>
        // Define API_BASE_URL once before loading other scripts
        window.API_BASE_URL = 'http://localhost:5000/api';
    </script>
    <script src="auth.js"></script>
    <script src="script.js"></script>
    <script>
        // Check authentication and show navbar, then initialize dropdowns
        document.addEventListener('DOMContentLoaded', async function() {
            const isLoggedIn = await window.authManager.checkAuth();
            if (!isLoggedIn) {
                // Redirect to login if not authenticated
                window.location.href = '/login.html';
                return;
            }
            // Show navbar and update buttons
            await window.authManager.updateNavbar();
            
            // Initialize dropdowns after authentication check
            // Wait a bit to ensure DOM and scripts are ready
            setTimeout(() => {
                console.log('Attempting to initialize prediction form...');
                console.log('window.initializePrediction:', typeof window.initializePrediction);
                console.log('loadStates:', typeof loadStates);
                console.log('setupEventListeners:', typeof setupEventListeners);
                
                if (typeof window.initializePrediction === 'function') {
                    console.log('Using window.initializePrediction');
                    window.initializePrediction();
                } else if (typeof initializePrediction === 'function') {
                    console.log('Using initializePrediction');
                    initializePrediction();
                } else if (typeof loadStates === 'function' && typeof setupEventListeners === 'function') {
                    console.log('Using fallback initialization (loadStates + setupEventListeners)');
                    loadStates();
                    setupEventListeners();
                } else {
                    console.error('Prediction initialization functions not available');
                    console.log('Available functions:', Object.keys(window).filter(k => k.includes('init') || k.includes('load') || k.includes('setup')));
                    // Try one more time after a longer delay
                    setTimeout(() => {
                        if (typeof loadStates === 'function') {
                            console.log('Retrying initialization...');
                            loadStates();
                            if (typeof setupEventListeners === 'function') {
                                setupEventListeners();
                            }
                        }
                    }, 500);
                }
            }, 500);
        });
    </script>
</body>
</html>

